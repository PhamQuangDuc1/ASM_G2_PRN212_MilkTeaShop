<Window x:Class="MilkTeaShop_Hantu.PaymentWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Thanh toán" Height="679" Width="964"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource PrimaryBackgroundBrush}">

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="340"/>
        </Grid.ColumnDefinitions>

        <!-- ===== Invoice / Cart List ===== -->
        <Border Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,10,0">
            <StackPanel>
                <TextBlock Text="🧾 Hóa đơn" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                <TextBlock Text="💡 Nhấp đúp vào sản phẩm để chỉnh sửa" FontSize="12" 
                          FontStyle="Italic" Foreground="{DynamicResource TextSecondaryBrush}" 
                          Margin="0,0,0,10"/>
                <ListView x:Name="InvoiceList" Height="350">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Tên món" Width="220" DisplayMemberBinding="{Binding Name}" />
                            <GridViewColumn Header="SL" Width="50" DisplayMemberBinding="{Binding Quantity}" />
                            <GridViewColumn Header="Giá" Width="80">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Price, StringFormat={}{0:N0}đ}" 
                                                  HorizontalAlignment="Right"
                                                  Foreground="{DynamicResource TextSecondaryBrush}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="Thành tiền" Width="110">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Subtotal, StringFormat={}{0:N0}đ}" 
                                                  HorizontalAlignment="Right"
                                                  FontWeight="SemiBold"
                                                  Foreground="{DynamicResource AccentBrush}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
                <TextBlock x:Name="TableInfoText" FontWeight="Bold" Margin="0,10,0,0"
                          Foreground="{DynamicResource AccentBrush}"/>
            </StackPanel>
        </Border>

        <!-- ===== Payment Panel ===== -->
        <Border Grid.Column="1" Style="{StaticResource CardStyle}">
            <StackPanel>
                <TextBlock Text="💳 Thanh toán" FontSize="18" FontWeight="Bold" Margin="0,0,0,15"/>

                <Grid Margin="0,0,0,15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="120"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Tổng cộng:" FontWeight="SemiBold"/>
                    <TextBlock Grid.Row="0" Grid.Column="1" x:Name="TxtSubtotal" Text="0đ" 
                              HorizontalAlignment="Right" FontWeight="Bold"
                              Foreground="{DynamicResource AccentBrush}"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="VAT (%)" 
                              VerticalAlignment="Center" Margin="0,8,0,0" FontWeight="SemiBold"/>
                    <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" 
                               HorizontalAlignment="Right" Margin="0,8,0,0">
                        <CheckBox x:Name="ChkVAT" IsChecked="True" 
                                 Checked="RecalculateTotals" Unchecked="RecalculateTotals"
                                 VerticalAlignment="Center"/>
                        <TextBlock Text="10%" VerticalAlignment="Center" Margin="8,0,0,0"
                                  FontWeight="SemiBold"/>
                    </StackPanel>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Giảm giá (VNĐ):" 
                              VerticalAlignment="Center" Margin="0,8,0,0" FontWeight="SemiBold"/>
                    <TextBox Grid.Row="2" Grid.Column="1" x:Name="TxtDiscount" Text="0" 
                            TextChanged="RecalculateTotals" HorizontalContentAlignment="Right" 
                            Margin="0,8,0,0" Height="32"/>

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="VAT (số tiền):" 
                              VerticalAlignment="Center" Margin="0,8,0,0" FontWeight="SemiBold"/>
                    <TextBlock Grid.Row="3" Grid.Column="1" x:Name="TxtVATAmount" Text="0đ" 
                              HorizontalAlignment="Right" Margin="0,8,0,0"
                              Foreground="{DynamicResource TextSecondaryBrush}"/>

                    <Separator Grid.Row="4" Grid.ColumnSpan="2" Margin="0,12,0,8" 
                              Background="{DynamicResource BorderBrush}"/>
                </Grid>

                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="120"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Thành tiền:" FontSize="16" FontWeight="Bold"/>
                    <TextBlock Grid.Column="1" x:Name="TxtTotal" Text="0đ" FontSize="16" 
                              FontWeight="Bold" HorizontalAlignment="Right"
                              Foreground="{DynamicResource AccentBrush}"/>
                </Grid>

                <Separator Margin="0,0,0,15" Background="{DynamicResource BorderBrush}"/>

                <TextBlock Text="Phương thức thanh toán:" FontWeight="Bold" Margin="0,0,0,8"/>
                <StackPanel Margin="0,0,0,15">
                    <RadioButton x:Name="RbCash" Content="💵 Tiền mặt" IsChecked="True" 
                                Checked="PaymentMethod_Changed" Margin="0,4"/>
                    <RadioButton x:Name="RbMomo" Content="📱 Momo" 
                                Checked="PaymentMethod_Changed" Margin="0,4"/>
                </StackPanel>

                <!-- ===== Cash Panel ===== -->
                <Border x:Name="CashPanel" Style="{StaticResource CardStyle}" 
                       Background="{DynamicResource SecondaryBackgroundBrush}" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Tiền khách đưa (VNĐ):" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <TextBox x:Name="TxtReceived" Text="0" TextChanged="TxtReceived_TextChanged" 
                                HorizontalContentAlignment="Right" Height="44" Width="269"/>
                        <TextBlock Text="Tiền thối:" FontWeight="SemiBold" Margin="0,10,0,5"/>
                        <TextBlock x:Name="TxtChange" Text="0đ" FontWeight="Bold" FontSize="16"
                                  Foreground="{DynamicResource AccentBrush}"/>
                    </StackPanel>
                </Border>

                <!-- ===== Momo Panel ===== -->
                <Border x:Name="MomoPanel" Style="{StaticResource CardStyle}" 
                       Background="{DynamicResource SecondaryBackgroundBrush}" 
                       Margin="0,0,0,15" Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock Text="📱 Quét QR Momo để thanh toán:" FontWeight="Bold" 
                                  HorizontalAlignment="Center" Margin="0,0,0,10"/>
                        <Border x:Name="MomoQRCodeBorder" BorderBrush="{DynamicResource BorderBrush}" 
                               BorderThickness="2" Width="200" Height="200" 
                               HorizontalAlignment="Center" CornerRadius="8">
                            <Image x:Name="MomoQRCode" Stretch="Uniform"/>
                        </Border>
                    </StackPanel>
                </Border>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button Content="✅ Xác nhận thanh toán" Width="180" Height="40" 
                           Background="{DynamicResource AccentBrush}" Foreground="White" FontWeight="Bold"
                           Click="ConfirmPayment_Click"/>
                    <Button Content="❌ Hủy" Width="80" Height="40" Margin="15,0,0,0" 
                           Background="{DynamicResource TextSecondaryBrush}" Foreground="White"
                           Click="Cancel_Click"/>
                </StackPanel>
            </StackPanel>
        </Border>
    </Grid>
</Window>